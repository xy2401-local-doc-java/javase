<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml">

<head>
  <title>The try-with-resources Statement</title>

<script language="javascript1.2" type="text/javascript" src="../../../../../webdesign/pubs/js/popUp.js"></script>
<script language="javascript1.2" type="text/javascript" src="../../../../../webdesign/pubs/js/sniff.js"></script>
<script language="javascript1.2" type="text/javascript" src="../../../../../webdesign/pubs/js/menucontent.js"></script>
<script language="javascript1.2" type="text/javascript" src="../../../../../webdesign/pubs/js/menucode.js"></script>
<script language="javascript1.2" type="text/javascript" src="../../../../../webdesign/pubs/js/developer.js"></script>
<script language="javascript1.2" type="text/javascript" src="../../../../../webdesign/other/js/search.js"></script>
<link rel="stylesheet" href="../../../../../webdesign/pubs/css/default_developer.css" />
<meta name="collection" content="reference"/> 
<script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>

<body>
<noscript>JavaScript is not supported by your browser. JavaScript
support is required for full functionality of this page.</noscript>
<div class="a0 a0v1" id="a0v1"><!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1 a1r2">
<div class="a1v0"><a href="#skip2content" class="skiplink">Skip to
Content</a></div>
</div>
<!-- END A1 COMPONENT V.0 -->
<!-- BEGIN A2 COMPONENT V.1 -->
<div class="a2w0">
<div class="a2" id="a2v1">
<div class="a2w1">
<div class="a2w2">
<div class="a2w3">
<div class="a2w4">
<div class="a2topiclinks"><a href="http://www.oracle.com" title=
"Oracle Home Page" id="sunlogo" name="sunlogo"><img src=
"../../../../../webdesign/pubs/im/a.gif" alt="Home Page" width="98" height="58"
border="0" /></a>
<ul id="mtopics">
<li id="mtopic1"><a id="glink1" class="tpclink a2menu" title=
"See Oracle Technology Network" href="http://oracle.com/technology"
name="glink1">Oracle Technology Network</a></li>
<li id="mtopic2"><a id="glink2" class="tpclink a2menu" title=
"Software Downloads" href=
"http://www.oracle.com/technology/software/index.html" name=
"glink2">Software Downloads</a></li>
<li id="mtopic3"><a id="glink3" class="tpclink a2menu" title=
"See Java SE Documentation" href=
"http://download.oracle.com/javase/index.html" name=
"glink3">Documentation</a></li>
</ul>
<div class="a2search"><a href="../../../../../search.html" target=
"_blank">Search</a></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- END A2 COMPONENT V.1 -->
<!-- BEGIN SEPARATOR -->
<div class="hr">
<hr /></div>
<!-- END SEPARATOR -->
<!-- ============ -->
<!-- MAIN CONTENT -->
<!-- ============ -->
<a name="skip2content" id="skip2content"></a>


<div class="smallpagetitle"><h1>The try-with-resources Statement</h1></div>

<p>The <code>try</code>-with-resources statement is a <code>try</code> statement that declares one or more resources. A <em>resource</em> is as an object that must be closed after the program is finished with it. The <code>try</code>-with-resources statement ensures that each resource is closed at the end of the statement. Any object that implements <code>java.lang.AutoCloseable</code>, which includes all objects which implement <code>java.io.Closeable</code>, can be used as a resource.</p>

<p>The following example reads the first line from a file. It uses an instance of <code>BufferedReader</code> to read data from the file. <code>BufferedReader</code> is a resource that must be closed after the program is finished with it:</p>

<pre>static String readFirstLineFromFile(String path) throws IOException {
  <strong>try (BufferedReader br = new BufferedReader(new FileReader(path)))</strong> {
    return br.readLine();
  }
}</pre>

<p>In this example, the resource declared in the <code>try</code>-with-resources statement is a <code>BufferedReader</code>. The declaration statement appears within parentheses immediately after the <code>try</code> keyword. The class <code>BufferedReader</code>, in Java SE 7 and later, implements the interface <code>java.lang.AutoCloseable</code>. Because the <code>BufferedReader</code> instance is declared in a <code>try</code>-with-resource statement, it will be closed regardless of whether the <code>try</code> statement completes normally or abruptly (as a result of the method <code>BufferedReader.readLine</code> throwing an <code>IOException</code>).</p>

<p>Prior to Java SE 7, you can use a <code>finally</code> block to ensure that a resource is closed regardless of whether the <code>try</code> statement completes normally or abruptly. The following example uses a <code>finally</code> block instead of a <code>try</code>-with-resources statement:</p>

<pre>static String readFirstLineFromFileWithFinallyBlock(String path) throws IOException {
  BufferedReader br = new BufferedReader(new FileReader(path));
  try {
    return br.readLine();
  } finally {
    if (br != null) br.close();
  }
}</pre>

<p>However, in this example, if the methods <code>readLine</code> and <code>close</code> both throw exceptions, then the method <code>readFirstLineFromFileWithFinallyBlock</code> throws the exception thrown from the <code>finally</code> block; the exception thrown from the <code>try</code> block is suppressed. In contrast, in the example <code>readFirstLineFromFile</code>, if exceptions are thrown from both the <code>try</code> block and the <code>try</code>-with-resources statement, then the method <code>readFirstLineFromFile</code> throws the exception thrown from the <code>try</code> block; the exception thrown from the <code>try</code>-with-resources block is suppressed. In Java SE 7 and later, you can retrieve suppressed exceptions; see the section <a href="#suppressed-exceptions">Suppressed Exceptions</a> for more information.</p>

<p>You may declare one or more resources in a <code>try</code>-with-resources statement. The following example retrieves the names of the files packaged in the zip file <code>zipFileName</code> and creates a text file that contains the names of these files:</p>

<pre>  public static void writeToFileZipFileContents(String zipFileName, String outputFileName)
    throws java.io.IOException {

    java.nio.charset.Charset charset = java.nio.charset.Charset.forName("US-ASCII");
    java.nio.file.Path outputFilePath = java.nio.file.Paths.get(outputFileName);

    // Open zip file and create output file with try-with-resources statement

    <strong>try (
      java.util.zip.ZipFile zf = new java.util.zip.ZipFile(zipFileName);
      java.io.BufferedWriter writer = java.nio.file.Files.newBufferedWriter(outputFilePath, charset)
    )</strong> {

      // Enumerate each entry

      for (java.util.Enumeration entries = zf.entries(); entries.hasMoreElements();) {

        // Get the entry name and write it to the output file

        String newLine = System.getProperty("line.separator");
        String zipEntryName = ((java.util.zip.ZipEntry)entries.nextElement()).getName() + newLine;
        writer.write(zipEntryName, 0, zipEntryName.length());
      }
    }
  }</pre>

<p>In this example, the <code>try</code>-with-resources statement contains two declarations that are separated by a semicolon: <code>ZipFile</code> and <code>BufferedWriter</code>. When the block of code that directly follows it terminates, either normally or because of an exception, the <code>close</code> methods of the <code>BufferedWriter</code> and <code>ZipFile</code> objects are automatically called in this order. Note that the <code>close</code> methods of resources are called in the <em>opposite</em> order of their creation.</p>

<p>The following example uses a <code>try</code>-with-resources statement to automatically close a <code>java.sql.Statement</code> object:</p>

<pre>  public static void viewTable(Connection con) throws SQLException {

    String query = "select COF_NAME, SUP_ID, PRICE, SALES, TOTAL from COFFEES";

    <strong>try (Statement stmt = con.createStatement())</strong> {

      ResultSet rs = stmt.executeQuery(query);

      while (rs.next()) {
        String coffeeName = rs.getString("COF_NAME");
        int supplierID = rs.getInt("SUP_ID");
        float price = rs.getFloat("PRICE");
        int sales = rs.getInt("SALES");
        int total = rs.getInt("TOTAL");
        System.out.println(coffeeName + ", " + supplierID + ", " + price +
                           ", " + sales + ", " + total);
      }

    } catch (SQLException e) {
      JDBCTutorialUtilities.printSQLException(e);
    }
  }</pre>

<p>The resource <code>java.sql.Statement</code> used in this example is part of the JDBC 4.1 and later API.</p>

<p><strong>Note</strong>: A <code>try</code>-with-resources statement can have <code>catch</code> and <code>finally</code> blocks just like an ordinary <code>try</code> statement. In a <code>try</code>-with-resources statement, any <code>catch</code> or <code>finally</code> block is run after the resources declared have been closed.</p>


<!-- ************************************** -->

<h2><a name="suppressed-exceptions">Suppressed Exceptions</a></h2>

<p>An exception can be thrown from the block of code associated with the <code>try</code>-with-resources statement. In the example <code>writeToFileZipFileContents</code>, an exception can be thrown from the <code>try</code> block, and up to two exceptions can be thrown from the <code>try</code>-with-resources statement when it tries to close the <code>ZipFile</code> and <code>BufferedWriter</code> objects. If an exception is thrown from the <code>try</code> block and one or more exceptions are thrown from the <code>try</code>-with-resources statement, then those exceptions thrown from the <code>try</code>-with-resources statement are suppressed, and the exception thrown by the block is the one that is thrown by the <code>writeToFileZipFileContents</code> method. You can retrieve these suppressed exceptions by calling the <code>Throwable.getSuppressed</code> method from the exception thrown by the <code>try</code> block.</p>

<h2>Classes That Implement the AutoCloseable or Closeable Interface</h2>

<p>See the Javadoc of the <a href="../../../api/java/lang/AutoCloseable.html"><code>AutoCloseable</code></a> and <a href="../../../api/java/io/Closeable.html"><code>Closeable</code></a> interfaces for a list of classes that implement either of these interfaces. The <code>Closeable</code> interface extends the <code>AutoCloseable</code> interface. The <code>close</code> method of the <code>Closeable</code> interface throws exceptions of type <code>IOException</code> while the <code>close</code> method of the <code>AutoCloseable</code> interface throws exceptions of type <code>Exception</code>. Consequently, subclasses of the <code>AutoCloseable</code> interface can override this behavior of the <code>close</code> method to throw specialized exceptions, such as <code>IOException</code>, or no exception at all.</p>


<div id="javasefooter">
<div class="hr">
<hr /></div>
<div id="javasecopyright">
<a href="../../../legal/cpyr.html">Copyright &#169;</a> 1993, 2018, Oracle
and/or its affiliates. All rights reserved.
</div>

<div id="javasecontactus">
<a href="http://docs.oracle.com/javase/feedback.html">Contact Us</a>
</div>
</div>
</div>

<!-- Start SiteCatalyst code   -->
<script language="JavaScript" type="text/javascript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code_download.js"></script>
<script language="JavaScript" type="text/javascript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code.js"></script>
 
<!-- ********** DO NOT ALTER ANYTHING BELOW THIS LINE ! *********** -->
<!--  Below code will send the info to Omniture server -->
<script language="javascript" type="text/javascript">var s_code=s.t();if(s_code)document.write(s_code)</script>
 
<!-- End SiteCatalyst code -->

</body>
</html>