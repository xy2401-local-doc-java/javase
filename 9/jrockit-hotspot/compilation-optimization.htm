<!DOCTYPE html>
<html lang="en-US">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="UTF-8" />
<title>Compilation Optimization</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)" />
<meta name="dcterms.created" content="2017-10-12T02:30:39Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Java Platform, Standard Edition JRockit to HotSpot Migration Guide" />
<meta name="dcterms.identifier" content="E76287-05" />
<meta name="dcterms.isVersionOf" content="JRHMG" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1995, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="../index.html" title="Home" type="text/html" />
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Prev" href="runtime.htm" title="Previous" type="text/html" />
<link rel="Next" href="logging.htm" title="Next" type="text/html" />
<link rel="alternate" href="JRHMG.pdf" title="PDF version" type="application/pdf" />
<link rel="alternate" href="JRHMG.epub" title="ePub version" type="application/epub+zip" />
<link rel="alternate" href="JRHMG.mobi" title="Mobipocket version" type="application/x-mobipocket-ebook" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../dcommon/css/fonts.css">
<link rel="stylesheet" href="../dcommon/css/foundation.css">
<link rel="stylesheet" href="../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css">
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
<script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-8033B236-F6E5-473B-BB9F-34422143A1AA"></a> <span id="PAGE" style="display:none;">7/11</span> <!-- End Header -->
<a id="JRHMG118"></a><a id="JRHMG117"></a>
<h1 id="JRHMG-GUID-8033B236-F6E5-473B-BB9F-34422143A1AA" class="sect1"><span class="enumeration_chapter">4</span> Compilation Optimization</h1>
<div>
<p>This topic describes the various compiler options available in Oracle JRockit and HotSpot to optimize compilation.</p>
<div class="p">
<ul style="list-style-type: disc;">
<li><a href="compilation-optimization.htm#GUID-92C9119B-C9F4-4BF6-91C8-527FE5C63657" title="Unlike Oracle JRockit, HotSpot features a Java byte code interpreter in addition to two different Just In Time (JIT) compilers: client (also known as C1) and server (also known as C2).">Compiler Considerations</a></li>
<li><a href="compilation-optimization.htm#GUID-A71FF797-0C8F-4E0A-B702-1AFC85A33FB4" title="The following table lists some important Oracle JRockit and HotSpot compiler options:">Important HotSpot JIT Compiler Options</a></li>
</ul>
</div>
</div>
<a id="JRHMG142"></a>
<div class="props_rev_3"><a id="GUID-92C9119B-C9F4-4BF6-91C8-527FE5C63657"></a>
<h2 id="JRHMG-GUID-92C9119B-C9F4-4BF6-91C8-527FE5C63657" class="sect2">Compiler Considerations</h2>
<div>
<p>Unlike Oracle JRockit, HotSpot features a Java byte code interpreter in addition to two different Just In Time (JIT) compilers: client (also known as C1) and server (also known as C2).</p>
<p>This section provides details about the complier that you can use.</p>
<p>HotSpot VM defaults to interpreting Java byte code. It compiles (JIT compilation) methods that runtime profiling determines to be "hot", that is, the methods that are executed for a predetermined number of times. JIT compliers are either client or server compilers.</p>
<ul style="list-style-type: disc;">
<li>
<p>Client compiler: It compiles methods quickly but emits machine code that is less optimized than the server compiler. This complier is used for quick startup. Also, in this compiler, the smaller memory footprint is more important than steady-state performance.</p>
</li>
<li>
<p>Server compiler: The compiler often takes more time (and memory) to compile the same methods. However, it generates better optimized machine code than the code generated by the client compiler. It provides better runtime performance after the application reaches the steady state.</p>
</li>
</ul>
<p>The tiered compilation enhances the server VM startup speed equivalent to the client VM speed by using client compiler as the first tier. A server VM uses the interpreter to collect the profiling information about the methods that is fed into the compiler. In the tiered scheme, in addition to the interpreter, the client compiler generates compiled versions of methods that collect profiling information about themselves. As the compiled code is substantially faster than the interpreter, the program executes with greater performance during this profiling phase. Often, a startup that is even faster than with the client VM can be achieved, because the final code produced by the server compiler is available during the early stages of application initialization. The tiered scheme can also achieve better peak performance than a regular server VM. This is because the faster profiling phase allows a longer period of profiling, which yields better optimization.</p>
<p>Tiered compilation is the default mode for the server VM. The 64-bit mode is supported. To enable tiered compilation manually, use the <code class="codeph">-XX:+TieredCompilation</code> flag. You can disable tiered compilation by using the <code class="codeph">-XX:-TieredCompilation</code> flag.</p>
<p>Oracle JRockit JVM compiles a Java method and generates the machine code for the first time it is invoked. This compiled code of frequently invoked methods is optimized in the background by an Optimizer thread. This code is different from the HotSpot where methods are interpreted first and compiled later, either by the client (fewer optimizations) or the server (more optimizations) compiler.</p>
</div>
</div>
<a id="JRHMG152"></a><a id="JRHMG119"></a>
<div class="props_rev_3"><a id="GUID-A71FF797-0C8F-4E0A-B702-1AFC85A33FB4"></a>
<h2 id="JRHMG-GUID-A71FF797-0C8F-4E0A-B702-1AFC85A33FB4" class="sect2">Important HotSpot JIT Compiler Options</h2>
<div>
<p>The following table lists some important Oracle JRockit and HotSpot compiler options:</p>
<div class="tblformalwide" id="GUID-A71FF797-0C8F-4E0A-B702-1AFC85A33FB4__GUID-2E710CCC-8A28-4C42-A1C1-4849429B2AB1">
<p class="titleintable">Table 4-1 JIT Compiler Options</p>
<table class="cellalignment290" title="JIT Compiler Options" summary="JIT Compiler Options">
<thead>
<tr class="cellalignment276">
<th class="cellalignment325" id="d1661e102">Oracle JRockit</th>
<th class="cellalignment326" id="d1661e105">HotSpot</th>
<th class="cellalignment313" id="d1661e108">Notes</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment276">
<td class="cellalignment327" id="d1661e113" headers="d1661e102">
<p><code class="codeph">-XnoOpt</code></p>
<p><code class="codeph">-XXoptFile:&lt;file</code>&gt;</p>
</td>
<td class="cellalignment328" headers="d1661e113 d1661e105">
<p>As JIT compilation in HotSpot is considered analogous to optimization in Oracle JRockit (that is, both techniques are only used on methods that are determined by profiling to be hot), the HotSpot equivalent to Oracle JRockit's <code class="codeph">-XnoOpt</code> is <code class="codeph">-Xint</code>. In this technique, no JIT compilation is done and only the byte code interpreter is used to execute all methods. This compilation might impact the performance. However, it can be useful when<code class="codeph">-XnoOpt</code> is used for troubleshooting or working around possible compiler issues of Oracle JRockit.</p>
<p>Like Oracle JRockit, HotSpot also offers ways to exclude methods from compilation or to disable specific optimizations on them.</p>
<p>If there are any problems while optimizing the methods, then use <code class="codeph">XnoOpt</code> or <code class="codeph">XXoptFile</code> options with Oracle JRockit VM to disable the optimization on those methods. However, to exclude the compilation or disable specific optimizations on these methods, ensure that you don&rsquo;t directly translate to HotSpot options.</p>
<p>The same compilation or optimization problems observed with the Oracle JRockit JVM for any specific methods are unlikely to happen with the HotSpot JVM. So, to begin with, it is best to remove these options while migrating to the HotSpot JVM.</p>
<p>Equivalent HotSpot JVM options are:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">-XX:CompileCommand=command,method[,option]</code></p>
<p>Specifies a command to perform on a method. For example, to exclude the <code class="codeph">indexOf()</code> method of the <code class="codeph">String</code> class from being compiled, use the following:</p>
<p><code class="codeph">-XX:CompileCommand=exclude,java/lang/String.indexOf</code></p>
</li>
<li>
<p><code class="codeph">-XX:CompileCommandFile=&lt;filename&gt;</code></p>
<p>Sets the file from which JIT compiler commands are read. By default, the <code class="codeph">.hotspot_compiler</code> file is used to store commands performed by the JIT compiler.</p>
</li>
<li>
<p><code class="codeph">-XX:CompileOnly=&lt;methods&gt;</code></p>
<p>Sets the list of methods (separated by commas) to which compilation must be restricted.</p>
</li>
<li>
<p><code class="codeph">-XX:CompileThreshold=&lt;invocations&gt;</code></p>
<p>Sets the number of interpreted method invocations before compilation. By default, in the server JVM, the JIT compiler performs 10,000 interpreted method invocations to gather information for efficient compilation. For the client JVM, the default setting is 1,500 invocations.</p>
</li>
</ul>
</td>
<td class="cellalignment315" headers="d1661e113 d1661e108">
<p>Options <code class="codeph">CompileCommand</code>, <code class="codeph">CompileCommandFile</code>, <code class="codeph">CompileOnly</code>, and <code class="codeph">CompileThreshold</code> can be used to disable or delay the compilation of specified methods.</p>
</td>
</tr>
<tr class="cellalignment276">
<td class="cellalignment327" id="d1661e200" headers="d1661e102">
<p><code class="codeph">-XX:OptThreads</code></p>
</td>
<td class="cellalignment328" headers="d1661e200 d1661e105">
<p>There are no optimization threads in HotSpot JVM. The count of compiler threads that perform both the compilation and the optimizations can be set using:</p>
<p><code class="codeph">-XX:CICompilerCount=&lt;threads&gt;</code></p>
</td>
<td class="cellalignment315" headers="d1661e200 d1661e108">
<p>Sets the number of compiler threads to use for compilation. By default, the number of threads is set to 2 for the server JVM, to 1 for the client JVM, and it scales to the number of cores if tiered compilation is used.</p>
</td>
</tr>
<tr class="cellalignment276">
<td class="cellalignment327" id="d1661e214" headers="d1661e102">
<p><code class="codeph">-XX:+ReserveCodeMemory</code></p>
<p><code class="codeph">-XX:MaxCodeMemory=&lt;size</code>&gt;</p>
</td>
<td class="cellalignment328" headers="d1661e214 d1661e105">
<p><code class="codeph">-XX:ReservedCodeCacheSize=&lt;size&gt;</code></p>
</td>
<td class="cellalignment315" headers="d1661e214 d1661e108">
<p>Sets the maximum code cache size (in bytes) for JIT-compiled code. This option is equivalent to <code class="codeph">-Xmaxjitcodesize</code>.</p>
</td>
</tr>
<tr class="cellalignment276">
<td class="cellalignment327" id="d1661e233" headers="d1661e102">
<p>None</p>
</td>
<td class="cellalignment328" headers="d1661e233 d1661e105">
<p><code class="codeph">-XX:+TieredCompilation</code></p>
</td>
<td class="cellalignment315" headers="d1661e233 d1661e108">
<p>Enables the use of tiered compilation. This option is enabled by default from JDK 8 and later versions. Only the Java HotSpot Server VM supports this option.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment275">
<tr>
<td class="cellalignment287">
<table class="cellalignment280">
<tr>
<td class="cellalignment279"><a href="runtime.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment279"><a href="logging.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1995, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment289">
<table class="cellalignment278">
<tr>
<td class="cellalignment279"><a href="../index.html"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment279"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment279"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
