<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<title>Response Controls</title>
<meta name="collection" content="learning">
<script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
<body BGCOLOR="#ffffff">
<table width="100%">
<tr>
<td align=left>
<a href="connect.html"><img src="../../images/PreviousArrow.gif" width=26 height=26 align=bottom border=0 alt="Previous | "></a><a
href="extensions.html"><img src="../../images/NextArrow.gif" width=26 height=26 align=bottom border=0 alt="Next | "></a><a
href="../../trailmap.html"><img src="../../images/WayUpArrow.gif" width=26 height=26 align=bottom border=0 alt="Trail Map | "></a><a
href="../index.html"><img src="../../jndiimages/ldapHeader.gif" width=26 height=26 align=bottom border=0 alt="Tips for LDAP Users | "></a>
</td>
<td align=right>
<a href="index.html"><strong><em>Controls and Extensions</em></strong></a>
</td>
</tr>
</table>
<P ALIGN="CENTER">
<IMG SRC="../../jndiimages/shoeline2.GIF" ALIGN="BOTTOM" BORDER="0" WIDTH="202"
    HEIGHT="25" NATURALSIZEFLAG="3">
<IMG SRC="../../jndiimages/shoeline2.GIF" ALIGN="BOTTOM" BORDER="0" WIDTH="202"
    HEIGHT="25" NATURALSIZEFLAG="3">
</P>

<h2>
    Response Controls
</h2>
<p>
<blockquote>

A <a href=../../getStarted/concepts/glossary.html#RESPCTL>response control</a>
allows a server to send more information to the
client than is allowed by the operation's response.
A one-to-one mapping between request
controls and response controls is not needed. 
That is, a server can send response controls along with
any response--they need not be in response to any
client-initiated request control.
<p>
Because an LDAP server might send response controls with any response,
you might be able to collect response controls after any 
<tt>Context</tt> method invocation.
However, realistically, you would check for response controls
only if you were expecting them.
<p>
<a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/LdapContext.html#getResponseControls()"><tt>LdapContext.getResponseControls()</tt></a><a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/LdapContext.html#getResponseControls()"><img src="../../images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>   is used to retrieve a context's response controls.
Each time that a method that communicates with the server is invoked
on a context, the LDAP service provider clears any previously
collected response controls and then collects all response
controls resulting from the current method invocation.
<p>
For example, the following code fragment examines the response controls
after a 
<a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/Context.html#lookup(javax.naming.Name)"><tt>Context.lookup()</tt></a><a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/Context.html#lookup(javax.naming.Name)"><img src="../../images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>    call.
<blockquote><pre>
// Perform lookup
Object answer = ctx.lookup("ou=People");

// Retrieve the response controls
Control[] respCtls = ctx.getResponseControls();
</pre></blockquote>
If you invoke two context methods and then use <tt>getResponseControls()</tt>,
you will get only the response controls generated by the most recent
context method.

<h4>Enumerations</h4>

Methods such as 

<a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/Context.html#list(javax.naming.Name)"><tt>Context.list()</tt></a><a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/Context.html#list(javax.naming.Name)"><img src="../../images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>    and
<a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/directory/DirContext.html#search(javax.naming.Name, java.lang.String, javax.naming.directory.SearchControls)"><tt>DirContext.search()</tt></a><a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/directory/DirContext.html#search(javax.naming.Name, java.lang.String, javax.naming.directory.SearchControls)"><img src="../../images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>    return a
<a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/NamingEnumeration.html"><tt>NamingEnumeration</tt></a><a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/NamingEnumeration.html"><img src="../../images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>.
Each member of a <tt>NamingEnumeration</tt> might have response controls.
One that does will implement the
<a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/HasControls.html"><tt>HasControls</tt></a><a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/HasControls.html"><img src="../../images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>    interface.
<p>
Here is an <a href=src/GetResponse.java>example</a> that shows you
how to retrieve the response controls from each member of a
<tt>NamingEnumeration</tt> that is generated by a <tt>search()</tt>.
<blockquote><pre>
// Perform the search
NamingEnumeration answer = ctx.search("ou=People", "(cn=*)", null);

// Examine the response controls (if any)
printControls("After search", ctx.getResponseControls());

// Enumerate the answers
while (answer.hasMore()) {
    SearchResult si = (SearchResult)answer.next();
    System.out.println(si);

    // Examine the response controls (if any)
    if (si instanceof HasControls) {
        printControls(si.getName(), ((HasControls)si).getControls());
    }
}

// Examine the response controls (if any)
printControls("After enumeration", ctx.getResponseControls());
</blockquote></pre>
This example performs a search, examines the response controls after
the search, and then enumerates the search results.
Next, it checks whether any member of the enumeration
implements the <tt>HasControls</tt> interface and, for any that do,
displays the response controls associated with the member.
After the enumeration completes, it checks for context
response controls by using
<tt>ctx.getResponseControls()</tt>.
This example defines a utility method, <tt>printControls()</tt>, that prints out a
<a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/Control.html"><tt>Control</tt></a><a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/Control.html"><img src="../../images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>    array.

<h4>Exceptions</h4>
If a context method throws an exception and the LDAP server
had sent response controls with the error response that generated
the exception, then you can retrieve the response controls by using
<tt>ctx.getResponseControls()</tt>. Here is an example.
<blockquote>
<pre>
try {
    // Perform the lookup
    Object answer = ctx.lookup("ou=People");

    // Retrieve the response controls
    Control[] respCtls = ctx.getResponseControls();

    // Display respCtls
} catch (NamingException e) {
    // Retrieve the response controls
    Control[] respCtls = ctx.getResponseControls();

    // Handle the exception
}
</pre></blockquote>

<h4>Implementations</h4>

The <tt>Control</tt> interface is generic 
for all request and response controls.
Typically, you will deal with implementation classes that implement
this interface rather than directly use the methods in this interface.
Such implementation classes typically have type-friendly and accessor methods.
After getting the response controls by using
<tt>getResponseControls()</tt>, you can cast the control to
its most derived class and use the class-specific accessor methods.
<p>
For example, Sun provides classes that implement some popular controls,
such as the server-side
<a href="http://www.ietf.org/rfc/rfc2891.txt">Sort</a> control.
The server-side Sort response control is represented by the
<tt>SortResponseControl</tt> class.
You can use the following code to access information about the 
server-side Sort response control.
<blockquote><pre>
if (controls[i] instanceof SortResponseControl) {
    SortResponseControl src = (SortResponseControl)controls[i];
		
    if (src.isSorted()) {
	// Result was sorted ...
    }
}
...
</pre></blockquote>

To do this casting and use specific control classes,
you must have some expectation of receiving such a control
from the server and must have made the control classes available to your
program. If either of these is lacking, then you can use only
the methods in the <tt>Control</tt> interface to determine
the identity of the control and to decode its contents.


<a NAME=FAC><h4>Response Control Factories</h4></a>

The JNDI allows an application to use control implementation
classes that are produced by any vendor.
To help service providers achieve this goal,
the JNDI provides the method
<a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/ControlFactory.html#getControlInstance(javax.naming.ldap.Control, javax.naming.Context, java.util.Hashtable)"><tt>ControlFactory.getControlInstance(Control, Context, Hashtable)</tt></a><a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/ControlFactory.html#getControlInstance(javax.naming.ldap.Control, javax.naming.Context, java.util.Hashtable)"><img src="../../images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>    for service providers to use to
transform (that is, <em>to narrow</em>) generic controls received from an LDAP server 
into control classes that are made available to the application.
<p>
To narrow a control, you use a
<em>control factory</em>, which is
represented by the abstract class
<a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/ControlFactory.html"><tt>ControlFactory</tt></a><a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/ControlFactory.html"><img src="../../images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>.
A control received from an LDAP server begins life
as a <tt>Control</tt> instance.
The LDAP service provider uses <tt>getControlInstance()</tt>
to narrow the control instance into a more type-specific one.
This method searches the list of <tt>ControlFactory</tt> class
implementations specified in the
<a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/LdapContext.html#CONTROL_FACTORIES"><tt>LdapContext.CONTROL_FACTORIES</tt></a><a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/LdapContext.html#CONTROL_FACTORIES"><img src="../../images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>    (<tt>"java.naming.factory.control"</tt>) environment property
for a class that can narrow the control.
<p>
For example, if an application uses an LDAP server that returns a special 
response control,
then the application can define a response control factory to parse the control
and to provide type-friendly accessor methods.
Here is <a href=src/SampleResponseControlFactory.java>an example</a>
of a response control factory.
<blockquote><pre>
public  class SampleResponseControlFactory extends ControlFactory {
    public SampleResponseControlFactory() {
    }

    public Control getControlInstance(Control ctl) throws NamingException {
	String id = ctl.getID();

	// See if it's one of yours
	if (id.equals(SampleResponseControl.OID)) {
	    return new SampleResponseControl(id, ctl.isCritical(),
		ctl.getEncodedValue());
	} 

	// It's not one of yours, so return null and
	// let someone else try
	return null;
    }
}
</pre></blockquote>
The factory class must have a public constructor that accepts no
arguments. It also must provide an implementation for the abstract method
<a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/ControlFactory.html#getControlInstance(javax.naming.ldap.Control)"><tt>ControlFactory.getControlInstance(Control)</tt></a><a target="_top" href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/ControlFactory.html#getControlInstance(javax.naming.ldap.Control)"><img src="../../images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>   . This method should check whether the input control is one that
it can narrow. If it is, then the method should process the control and return an object of
a more type-specific class. If it is not, then it
should return <tt>null</tt> so that other factories may be tried.

</blockquote>
<p>
<hr size=4>
<p> 
<table width="100%">
<tr>
<td align=left>
<a href="connect.html"><img src="../../images/PreviousArrow.gif" width=26 height=26 align=top border=0 alt="Previous | "></a><a
href="extensions.html"><img src="../../images/NextArrow.gif" width=26 height=26 align=top border=0 alt="Next | "></a><a
href="../../trailmap.html"><img src="../../images/WayUpArrow.gif" width=26 height=26 align=top border=0 alt="Trail Map | "></a><a
href="../index.html"><img src="../../jndiimages/ldapHeader.gif" width=26 height=26 align=top border=0 alt="Tips for LDAP Users | "></a>
</td>
<td align=right>
<a href="index.html"><strong><em>Controls and Extensions</em></strong></a>
</td>
</tr>
</table>
<!-- Start SiteCatalyst code   -->
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code_download.js"></script>
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code.js"></script>
 
<!-- ********** DO NOT ALTER ANYTHING BELOW THIS LINE ! *********** -->
<!--  Below code will send the info to Omniture server -->
<script language="javascript">var s_code=s.t();if(s_code)document.write(s_code)</script>
 
<!-- End SiteCatalyst code -->
</body>
</html>

