<!DOCTYPE html>
<html lang="en-US">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="UTF-8" />
<title>Prepare Java for Troubleshooting</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)" />
<meta name="description" content="This chapter provides some guidelines for setting up both Java and a Java application for better troubleshooting techniques. These proactive Java setups help debug and narrow down issues with Java and the application. Not all suggestions apply to every application." />
<meta name="dcterms.created" content="2018-03-12T22:27:13Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Java Platform, Standard Edition Troubleshooting Guide" />
<meta name="dcterms.identifier" content="E91156-01" />
<meta name="dcterms.isVersionOf" content="JSTGD" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1995, 2018, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="http://docs.oracle.com/javase/10/index.html" title="Home" type="text/html" />
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Prev" href="general-java-troubleshooting.htm" title="Previous" type="text/html" />
<link rel="Next" href="diagnostic-tools.htm" title="Next" type="text/html" />
<link rel="alternate" href="JSTGD.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../dcommon/css/fonts.css">
<link rel="stylesheet" href="../dcommon/css/foundation.css">
<link rel="stylesheet" href="../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css">
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
<script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-28AFFE4C-4526-4C1F-9C47-32D669BCAF1E"></a> <span id="PAGE" style="display:none;">5/31</span> <!-- End Header -->
<a id="JSTGD109"></a><a id="JSTGD108"></a>
<h1 id="JSTGD-GUID-28AFFE4C-4526-4C1F-9C47-32D669BCAF1E" class="sect1"><span class="enumeration_chapter">1</span> Prepare Java for Troubleshooting</h1>
<div>
<div><span>This chapter provides some guidelines for setting up both Java and a Java application for better troubleshooting techniques. These proactive Java setups help debug and narrow down issues with Java and the application. Not all suggestions apply to every application.</span></div>
<p>This chapter contains the following sections:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="prepare-java-troubleshooting.htm#GUID-9058D741-AF5D-4F22-B0DD-FEF090545229" title="Set up the Java environment and command-line options to enable gathering relevant data for troubleshooting.">Set Up Java for Troubleshooting</a></p>
</li>
<li>
<p><a href="prepare-java-troubleshooting.htm#GUID-CFA2A634-2C12-4A68-8A34-50E56C5AC16D" title="Set up JVM options and flags to enable gathering relevant data for troubleshooting.">Enable Options and Flags for JVM Troubleshooting</a></p>
</li>
<li>
<p><a href="prepare-java-troubleshooting.htm#GUID-5F04F68A-8F6B-4508-B2F9-0C1DD5E72319" title="If your application runs into a problem and you want to debug the problem further, ensure that you collect any relevant data before restarting the system, especially if restarting will remove previous files.">Gather Relevant Data</a></p>
</li>
</ul>
</div>
<a id="JSTGD110"></a>
<div class="props_rev_3"><a id="GUID-9058D741-AF5D-4F22-B0DD-FEF090545229"></a>
<h2 id="JSTGD-GUID-9058D741-AF5D-4F22-B0DD-FEF090545229" class="sect2">Set Up Java for Troubleshooting</h2>
<div>
<p>Set up the Java environment and command-line options to enable gathering relevant data for troubleshooting.</p>
<div class="section">
<p>To set up Java, perform the following:</p>
</div>
<!-- class="section" -->
<ol>
<li><span><span class="bold">Update the Java version:</span> Use the latest Java version to avoid spending time on troubleshooting issues in Java that were fixed. Often, a problem caused by a bug in the Java runtime is fixed in the latest update release. Working with the latest Java version helps avoid some known and common issues.</span></li>
<li><span><span class="bold">Set up the Java environment to debug:</span> Consider the following scenarios while setting up a bigger Java application, starting an application with a launcher script, or running distributed Java on several machines.</span>
<ol>
<li class="substepexpand"><span><span class="bold">Make it easy to change the Java version:</span> Using the latest Java version helps avoid many runtime issues. If your application starts by running a script, ensure that you have to update the Java path in only one place. If you run in a distributed system, then think about easy ways to change the Java versions across all of the machines.</span></li>
<li class="substepexpand"><span><span class="bold">Make it easy to change the Java command-line options:</span> Sometimes, while troubleshooting, you may want to change Java options; for example, to add a verbose output, to turn off a feature, or to tune Java for better performance. Prepare the systems for these changes.</span>
<div>In a Java application that is running remotely, for example in a testing framework or a cloud solution, ensure that you can still change the Java flags easily. Sometimes, the application takes command-line parameters, or you may want to try a flag quickly to reproduce a problem. Prepare the systems to make these changes easy.</div>
</li>
</ol>
</li>
</ol>
</div>
</div>
<a id="JSTGD111"></a>
<div class="props_rev_3"><a id="GUID-CFA2A634-2C12-4A68-8A34-50E56C5AC16D"></a>
<h2 id="JSTGD-GUID-CFA2A634-2C12-4A68-8A34-50E56C5AC16D" class="sect2">Enable Options and Flags for JVM Troubleshooting</h2>
<div>
<p>Set up JVM options and flags to enable gathering relevant data for troubleshooting.</p>
<div class="section">
<p>The data you gather depends on the system and what data you would use in case you run into problems. Consider gathering the following data.</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span><span class="bold">Enable core files:</span> If Java crashes, for example due to a segmentation fault, the OS saves to disk a <span class="italic">core file</span> (complete dump of the memory). On Linux and Solaris, <span class="italic">core files</span> are sometimes disabled by default. To enable <span class="italic">core files</span> on Linux/Solaris, it is usually enough to run the <code class="codeph">ulimit -c unlimited</code> before starting the application command. Some systems may have different ways to handle these limits.</span>
<div>
<div class="p">
<div class="infobox-note" id="GUID-CFA2A634-2C12-4A68-8A34-50E56C5AC16D__GUID-1A02E4ED-A3D2-4AD1-A548-C6826BCE4AEF">
<p class="notep1">Note:</p>
The <span class="italic">core files</span> take up a lot of disk space, especially when run with a large Java heap.</div>
</div>
<p>To decide whether to enable <span class="italic">core files</span>, consider what you would do if you had a crash in your system. Would you want to see a core file? Many Java users won't have much use for a core file. However, if you would want to debug a possible crash either in a native debugger such as <code class="codeph">gdb</code> or by using the <span class="italic">Serviceability Agent</span>, then ensure that you enable <span class="italic">core files</span> before the starting the application.</p>
<p>Many times, crashes are hard to reproduce; therefore, enable core files before the starting the application.</p>
</div>
</li>
<li class="stepexpand"><span><span class="bold">Add -XX:+HeapDumpOnOutOfMemoryError to the JVM flags:</span> The <code class="codeph">-XX:+HeapDumpOnOutOfMemoryError</code> flag saves a Java Heap dump to disk if the applications runs into an <code class="codeph">OutOfMemoryError</code>.</span>
<div>
<p>Like <span class="italic">core files</span>, heap dumps can be very large, especially when run with a big Java heap.</p>
<p>Again, think about what you would do if the application runs into an <code class="codeph">OutOfMemoryError</code>. Would you want to inspect the heap at the time of the error? In that case, turn flag by default so that you get this data if the application runs into an unexpected <code class="codeph">OutOfMemoryError</code>.</p>
</div>
</li>
<li class="stepexpand"><span><span class="bold">Run a continuous Java flight recording:</span> The Java Flight Recorder (JFR) is a commercial feature. You can use it for free on developer desktops and laptops, and for evaluation purposes in test, development, and production environments. <span class="bold">However, to enable JFR on a production server, you must have a commercial license</span>.</span>
<div>
<p>Set up Java to run with a continuous flight recording. Continuous flight recordings are a circular buffer of JFR events. If the application runs into an issue, you can dump the data from the last hour of the run. The JFR events can be helpful to debug a wide range of issues from memory leaks to network errors, high CPU usage, thread blocks, and so on.</p>
<p>The overhead of running with a continuous flight recording is very low. See <a href="diagnostic-tools.htm#GUID-14DD9297-94CE-4B03-B6B9-4D5B6A7774DC" title="Use Java Mission Control (JMC) to easily manage flight recordings.Use startup flags at the command line to produce profiling recording, continuous recording, and using diagnostic commands.You can set up Java Mission Control to automatically start or dump a flight recording if a condition is met. This is done from the JMX console. To start the JMX console, find your application in the JVM Browser, right-click it, and select Start JMX Browser.">How to Produce a Flight Recording</a> for producing a continuous Java Flight Recording.</p>
</div>
</li>
<li class="stepexpand"><span><span class="bold">Add -verbosegc to the JVM command-line:</span> The flag <code class="codeph">-verbosegc</code> logs basic information about Java Garbage Collector. This log helps you find the following:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p>Does garbage collection run for a long time?</p>
</li>
<li>
<p>Does the free memory decrease over time?</p>
</li>
</ul>
<p>The garbage collector log helps diagnose issues when the application throws an <code class="codeph">OutOFMemoryError</code> or the application runs into performance issues; therefore, turning on the <code class="codeph">-verbosegc</code> flag by default helps troubleshoot issues.</p>
<div class="p">
<div class="infobox-note" id="GUID-CFA2A634-2C12-4A68-8A34-50E56C5AC16D__GUID-163F3746-DB57-49E9-92DA-25AB91CA9098">
<p class="notep1">Note:</p>
Use log rotation so that an application restart doesn't delete the previous logs. Since JDK7, the flags <code class="codeph">UseGClogFileRotation</code> and <code class="codeph">NumberOfGCLogFiles</code> can be used to set up for log rotation. For a description of these flags, see <a href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html" target="_blank">Debugging Options for Java HotSpot VM</a>.</div>
</div>
</div>
</li>
<li class="stepexpand"><span><span class="bold">Print Java version and JVM flags:</span> Before filing a bug on Java or seeking help from a forum, have the basic information handy in the log files. For example, it's helpful to print the Java version and the JVM flags used.</span>
<div>
<p>If your application starts with a script, run <code class="codeph">java -version</code> to print the Java version and print the command line before executing it. Another alternative is to add <code class="codeph">-XX+PrintCommandLineFlags</code> and <code class="codeph">-showversion</code> to the JVM arguments.</p>
</div>
</li>
<li class="stepexpand"><span><span class="bold">Set up JMC JMX for remote monitoring:</span> JMX can be used to connect to a Java application remotely using tools such as Mission Control or Visual VM. Unless you can run these tools on the same machine that is running your application, setting this up can be helpful later on to monitor the application, send diagnostic commands, manage flight recordings, and so on. There is no performance overhead if you enable JMX.</span>
<div>
<p>Another alternative, is to enable JMX after a Java application has started is to use the diagnostic command <code class="codeph">ManagementAgent.start</code>. Run <code class="codeph">jcmd &lt;pid&gt; help ManagementAgent.start</code> for a list of flags that can be sent with the command.</p>
<p>See <a href="diagnostic-tools.htm#GUID-42A18B29-B4AD-4831-B846-2CDBA55F2254" title="The jcmd utility is used to send diagnostic command requests to the JVM, where these requests are useful for controlling Java Flight Recordings, troubleshoot, and diagnose JVM and Java applications.">The jcmd Utility</a>.</p>
</div>
</li>
</ol>
</div>
</div>
<a id="JSTGD112"></a>
<div class="props_rev_3"><a id="GUID-5F04F68A-8F6B-4508-B2F9-0C1DD5E72319"></a>
<h2 id="JSTGD-GUID-5F04F68A-8F6B-4508-B2F9-0C1DD5E72319" class="sect2">Gather Relevant Data</h2>
<div>
<p>If your application runs into a problem and you want to debug the problem further, ensure that you collect any relevant data before restarting the system, especially if restarting will remove previous files.</p>
<ul>
<li class="stepexpand"><span>It is important to gather the following files:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p>Core files for crash issues.</p>
</li>
<li>
<p><code class="codeph">hs_err</code> printed text file for Java crashes.</p>
</li>
<li>
<p>Log files: Java and application logs.</p>
</li>
<li>
<p>Java heap dumps for <code class="codeph">-XX:+HeapDumpOnOutOfMemoryError</code>.</p>
</li>
<li>
<p>Java flight recordings (if enabled). If the problem didn't terminate the application, dump the continuous recordings.</p>
</li>
</ul>
</div>
</li>
<li class="stepexpand"><span>If the application stopped responding, then gather the following files:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p>Stack traces: Take several stack traces using <code class="codeph">jcmd &lt;pid&gt; Thread.print</code> before restarting the system.</p>
</li>
<li>
<p>Dump flight recordings (if enabled).</p>
</li>
<li>
<p>Force a core file: If the application can't be closed properly, then stop the application, and force a core file using <code class="codeph">kill -6 &lt;pid&gt;</code> on Linux or Solaris systems.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<a id="JSTGD113"></a>
<div class="props_rev_3"><a id="GUID-9CBBB26E-E7DB-45D6-AF74-5CC44BF01287"></a>
<h3 id="JSTGD-GUID-9CBBB26E-E7DB-45D6-AF74-5CC44BF01287" class="sect3">Make a Java Application Easier to Debug</h3>
<div>
<p>Using a logging framework is a good way to enable future debugging.</p>
<p>If you run into problems in a specific module, you should be able to enable logging in that module. It is also good to specify different levels of logging, for example info, debug, and trace.</p>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment340">
<tr>
<td class="cellalignment347">
<table class="cellalignment345">
<tr>
<td class="cellalignment344"><a href="general-java-troubleshooting.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment344"><a href="diagnostic-tools.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1995, 2018, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment349">
<table class="cellalignment343">
<tr>
<td class="cellalignment344"><a href="http://docs.oracle.com/javase/10/index.html"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment344"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment344"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
