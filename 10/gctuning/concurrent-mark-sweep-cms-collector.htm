<!DOCTYPE html>
<html lang="en-US" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="UTF-8" />
<title>Concurrent Mark Sweep (CMS) Collector</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)" />
<meta name="description" content="The Concurrent Mark Sweep (CMS) collector is designed for applications that prefer shorter garbage collection pauses and that can afford to share processor resources with the garbage collector while the application is running." />
<meta name="dcterms.created" content="2018-03-13T02:53:16Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Java Platform, Standard Edition HotSpot Virtual Machine Garbage Collection Tuning Guide" />
<meta name="dcterms.identifier" content="E92394-01" />
<meta name="dcterms.isVersionOf" content="JSGCT" />
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2014, 2018, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved." />
<link rel="Start" href="http://docs.oracle.com/javase/10/index.html" title="Home" type="text/html" />
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Prev" href="mostly-concurrent-collectors.htm" title="Previous" type="text/html" />
<link rel="Next" href="garbage-first-garbage-collector.htm" title="Next" type="text/html" />
<link rel="alternate" href="JSGCT.pdf" title="PDF version" type="application/pdf" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../dcommon/css/fonts.css">
<link rel="stylesheet" href="../dcommon/css/foundation.css">
<link rel="stylesheet" href="../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css">
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
<script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-FF8150AC-73D9-4780-91DD-148E63FA1BFF"></a> <span id="PAGE" style="display:none;">11/14</span> <!-- End Header -->
<h1 id="JSGCT-GUID-FF8150AC-73D9-4780-91DD-148E63FA1BFF" class="sect1"><span class="enumeration_chapter">8</span> Concurrent Mark Sweep (CMS) Collector</h1>
<div>
<p>The Concurrent Mark Sweep (CMS) collector is designed for applications that prefer shorter garbage collection pauses and that can afford to share processor resources with the garbage collector while the application is running.</p>
<p>Typically applications that have a relatively large set of long-lived data (a large old generation) and run on machines with two or more processors tend to benefit from the use of this collector. The CMS collector is enabled with the command-line option <code class="codeph">-XX:+UseConcMarkSweepGC</code>.</p>
<p>The CMS collector is deprecated. Strongly consider using the Garbage-First collector instead.</p>
<div class="section">
<p class="subhead1">Topics</p>
<ul style="list-style-type: disc;">
<li><a href="concurrent-mark-sweep-cms-collector.htm#GUID-4CB5DCEB-FCBF-4A57-83A1-F2C47BF0B3D7" title="Similar to the other available collectors, the CMS collector is generational; thus both minor and major collections occur. The CMS collector attempts to reduce pause times due to major collections by using separate garbage collector threads to trace the reachable objects concurrently with the execution of the application threads.">Concurrent Mark Sweep Collector Performance and Structure</a></li>
<li><a href="concurrent-mark-sweep-cms-collector.htm#GUID-700D5A4A-75EE-4CDC-9A43-5DF8FEBE24DD" title="The CMS collector uses one or more garbage collector threads that run simultaneously with the application threads with the goal of completing the collection of the old generation before it becomes full.">Concurrent Mode Failure</a></li>
<li><a href="concurrent-mark-sweep-cms-collector.htm#GUID-8A7DC9B6-0448-4AC5-8F6D-41C83B6C618E" title="The CMS collector throws an OutOfMemoryError if too much time is being spent in garbage collection: If more than 98% of the total time is spent in garbage collection and less than 2% of the heap is recovered, then an OutOfMemoryError is thrown.">Excessive GC Time and OutOfMemoryError</a></li>
<li><a href="concurrent-mark-sweep-cms-collector.htm#GUID-72A6F5B6-93D6-4F25-8EDB-1D467FE2D7C3" title="The CMS collector, like all the other collectors in Java HotSpot VM, is a tracing collector that identifies at least all the reachable objects in the heap.">Concurrent Mark Sweep Collector and Floating Garbage</a></li>
<li><a href="concurrent-mark-sweep-cms-collector.htm#GUID-937A32AD-E2EA-4109-823D-A66D001A1807" title="The CMS collector pauses an application twice during a concurrent collection cycle. The first pause is to mark as live the objects directly reachable from the roots (for example, object references from application thread stacks and registers, static objects, and so on) and from elsewhere in the heap (for example, the young generation).">Concurrent Mark Sweep Collector Pauses</a></li>
<li><a href="concurrent-mark-sweep-cms-collector.htm#GUID-9ED1CD04-A251-459A-9F49-008509F2FAE7" title="The concurrent tracing of the reachable object graph occurs between the initial mark pause and the remark pause.">Concurrent Mark Sweep Collector Concurrent Phases</a></li>
<li><a href="concurrent-mark-sweep-cms-collector.htm#GUID-2F92DC98-6D4E-4C5B-9C6A-A679E17E4C38" title="With the serial collector a major collection occurs whenever the old generation becomes full and all application threads are stopped while the collection is done. In contrast, the start of a concurrent collection in CMS collector must be timed such that the collection can finish before the old generation becomes full; otherwise, the application would observe longer pauses due to concurrent mode failure. There are several ways to start a concurrent collection.">Starting a Concurrent Collection Cycle</a></li>
<li><a href="concurrent-mark-sweep-cms-collector.htm#GUID-704EEEB0-EE76-44D4-BA18-FA92F5A7574A" title="The pauses for the young generation collection and the old generation collection occur independently.">Scheduling Pauses</a></li>
<li><a href="concurrent-mark-sweep-cms-collector.htm#GUID-613350C4-0F12-48C4-A004-E5A7FCFB09FB">Concurrent Mark Sweep Collector Measurements</a></li>
</ul>
</div>
<!-- class="section" --></div>
<div class="props_rev_3"><a id="GUID-4CB5DCEB-FCBF-4A57-83A1-F2C47BF0B3D7"></a>
<h2 id="JSGCT-GUID-4CB5DCEB-FCBF-4A57-83A1-F2C47BF0B3D7" class="sect2">Concurrent Mark Sweep Collector Performance and Structure</h2>
<div>
<p>Similar to the other available collectors, the CMS collector is generational; thus both minor and major collections occur. The CMS collector attempts to reduce pause times due to major collections by using separate garbage collector threads to trace the reachable objects concurrently with the execution of the application threads.</p>
<p>During each major collection cycle, the CMS collector pauses all the application threads for a brief period at the beginning of the collection and again toward the middle of the collection. The second pause tends to be the longer of the two pauses. Multiple threads perform the collection work during both pauses. One or more garbage collector threads do the remainder of the collection (including most of the tracing of live objects and sweeping of unreachable objects). Minor collections can interleave with an ongoing major cycle, and are done in a manner similar to the parallel collector (in particular, the application threads are stopped during minor collections).</p>
</div>
</div>
<div class="props_rev_3"><a id="GUID-700D5A4A-75EE-4CDC-9A43-5DF8FEBE24DD"></a>
<h2 id="JSGCT-GUID-700D5A4A-75EE-4CDC-9A43-5DF8FEBE24DD" class="sect2">Concurrent Mode Failure</h2>
<div>
<p>The CMS collector uses one or more garbage collector threads that run simultaneously with the application threads with the goal of completing the collection of the old generation before it becomes full.</p>
<p>As described previously, in normal operation, the CMS collector does most of its tracing and sweeping work with the application threads still running, so only brief pauses are seen by the application threads. However, if the CMS collector is unable to finish reclaiming the unreachable objects before the old generation fills up, or if an allocation cannot be satisfied with the available free space blocks in the old generation, then the application is paused and the collection is completed with all the application threads stopped. The inability to complete a collection concurrently is referred to as <span class="italic">concurrent mode failure</span> and indicates the need to adjust the CMS collector parameters. If a concurrent collection is interrupted by an explicit garbage collection (<span class="apiname">System.gc()</span>) or for a garbage collection needed to provide information for diagnostic tools, then a concurrent mode interruption is reported.</p>
</div>
</div>
<div class="props_rev_3"><a id="GUID-8A7DC9B6-0448-4AC5-8F6D-41C83B6C618E"></a>
<h2 id="JSGCT-GUID-8A7DC9B6-0448-4AC5-8F6D-41C83B6C618E" class="sect2">Excessive GC Time and OutOfMemoryError</h2>
<div>
<p>The CMS collector throws an <code class="codeph">OutOfMemoryError</code> if too much time is being spent in garbage collection: If more than 98% of the total time is spent in garbage collection and less than 2% of the heap is recovered, then an <samp class="msgph">OutOfMemoryError</samp> is thrown.</p>
<p>This feature is designed to prevent applications from running for an extended period of time while making little or no progress because the heap is too small. If necessary, this feature can be disabled by adding the option <code class="codeph">-XX:-UseGCOverheadLimit</code> to the command line.</p>
<p>The policy is the same as that in the parallel collector, except that time spent performing concurrent collections isn't counted toward the 98% time limit. In other words, only collections performed while the application is stopped count toward excessive GC time. Such collections are typically due to a concurrent mode failure or an explicit collection request (for example, a call to <code class="codeph">System.gc()</code>).</p>
</div>
</div>
<div class="props_rev_3"><a id="GUID-72A6F5B6-93D6-4F25-8EDB-1D467FE2D7C3"></a>
<h2 id="JSGCT-GUID-72A6F5B6-93D6-4F25-8EDB-1D467FE2D7C3" class="sect2">Concurrent Mark Sweep Collector and Floating Garbage</h2>
<div>
<p>The CMS collector, like all the other collectors in Java HotSpot VM, is a tracing collector that identifies at least all the reachable objects in the heap.</p>
<p>Richard Jones and Rafael D. Lins in their publication <span class="italic">Garbage Collection: Algorithms for Automated Dynamic Memory</span>, it's an incremental update collector. Because application threads and the garbage collector thread run concurrently during a major collection, objects that are traced by the garbage collector thread may subsequently become unreachable by the time collection process ends. Such unreachable objects that haven't yet been reclaimed are referred to as <span class="variable">floating garbage</span>. The amount of floating garbage depends on the duration of the concurrent collection cycle and on the frequency of reference updates, also known as <span class="variable">mutations</span>, by the application. Furthermore, because the young generation and the old generation are collected independently, each acts as a source of roots to the other. As a rough guideline, try increasing the size of the old generation by 20% to account for the floating garbage. Floating garbage in the heap at the end of one concurrent collection cycle is collected during the next collection cycle.</p>
</div>
</div>
<div class="props_rev_3"><a id="GUID-937A32AD-E2EA-4109-823D-A66D001A1807"></a>
<h2 id="JSGCT-GUID-937A32AD-E2EA-4109-823D-A66D001A1807" class="sect2">Concurrent Mark Sweep Collector Pauses</h2>
<div>
<p>The CMS collector pauses an application twice during a concurrent collection cycle. The first pause is to mark as live the objects directly reachable from the roots (for example, object references from application thread stacks and registers, static objects, and so on) and from elsewhere in the heap (for example, the young generation).</p>
<p>This first pause is referred to as the <span class="variable">initial mark pause</span>. The second pause comes at the end of the concurrent tracing phase and finds objects that were missed by the concurrent tracing due to updates by the application threads of references in an object after the CMS collector had finished tracing that object. This second pause is referred to as the <span class="variable">remark pause</span>.</p>
</div>
</div>
<div class="props_rev_3"><a id="GUID-9ED1CD04-A251-459A-9F49-008509F2FAE7"></a>
<h2 id="JSGCT-GUID-9ED1CD04-A251-459A-9F49-008509F2FAE7" class="sect2">Concurrent Mark Sweep Collector Concurrent Phases</h2>
<div>
<p>The concurrent tracing of the reachable object graph occurs between the initial mark pause and the remark pause.</p>
<p>During this concurrent tracing phase, one or more concurrent garbage collector threads may be using processor resources that would otherwise have been available to the application. As a result, compute-bound applications may see a commensurate decrease in application throughput during this and other concurrent phases even though the application threads aren&rsquo;t paused. After the remark pause, a concurrent sweeping phase collects the objects identified as unreachable. After a collection cycle completes, the CMS collector waits, consuming almost no computational resources, until the start of the next major collection cycle.</p>
</div>
</div>
<div class="props_rev_3"><a id="GUID-2F92DC98-6D4E-4C5B-9C6A-A679E17E4C38"></a>
<h2 id="JSGCT-GUID-2F92DC98-6D4E-4C5B-9C6A-A679E17E4C38" class="sect2">Starting a Concurrent Collection Cycle</h2>
<div>
<p>With the serial collector a major collection occurs whenever the old generation becomes full and all application threads are stopped while the collection is done. In contrast, the start of a concurrent collection in CMS collector must be timed such that the collection can finish before the old generation becomes full; otherwise, the application would observe longer pauses due to concurrent mode failure. There are several ways to start a concurrent collection.</p>
<p>Based on recent history, the CMS collector maintains estimates of the time remaining before the old generation will be exhausted and of the time needed for a concurrent collection cycle. Using these dynamic estimates, a concurrent collection cycle is started with the aim of completing the collection cycle before the old generation is exhausted. These estimates are padded for safety because concurrent mode failure can be very costly.</p>
<p>A concurrent collection also starts if the occupancy of the old generation exceeds an initiating occupancy (a percentage of the old generation). The default value for this initiating occupancy threshold is approximately 92%, but the value is subject to change from release to release. This value can be manually adjusted using the command-line option <code class="codeph">-XX:CMSInitiatingOccupancyFraction=</code><code class="codeph">&lt;N&gt;</code>, where <code class="codeph">&lt;N&gt;</code> is an integral percentage (0 to 100) of the old generation size.</p>
</div>
</div>
<div class="props_rev_3"><a id="GUID-704EEEB0-EE76-44D4-BA18-FA92F5A7574A"></a>
<h2 id="JSGCT-GUID-704EEEB0-EE76-44D4-BA18-FA92F5A7574A" class="sect2">Scheduling Pauses</h2>
<div>
<p>The pauses for the young generation collection and the old generation collection occur independently.</p>
<p>They don't overlap, but may occur in quick succession such that the pause from one collection, immediately followed by one from the other collection, can appear to be a single, longer pause. To avoid this, the CMS collector attempts to schedule the remark pause roughly midway between the previous and next young generation pauses. This scheduling is currently not done for the initial mark pause, which is usually much shorter than the remark pause.</p>
</div>
</div>
<div class="props_rev_3"><a id="GUID-613350C4-0F12-48C4-A004-E5A7FCFB09FB"></a>
<h2 id="JSGCT-GUID-613350C4-0F12-48C4-A004-E5A7FCFB09FB" class="sect2">Concurrent Mark Sweep Collector Measurements</h2>
<div>
<div class="section">
<p>The following is the output from the CMS collector with the option <code class="codeph">-Xlog:gc</code>:</p>
<pre dir="ltr">
[121,834s][info][gc] GC(657) Pause Initial Mark 191M-&gt;191M(485M) (121,831s, 121,834s) 3,433ms
[121,835s][info][gc] GC(657) Concurrent Mark (121,835s)
[121,889s][info][gc] GC(657) Concurrent Mark (121,835s, 121,889s) 54,330ms
[121,889s][info][gc] GC(657) Concurrent Preclean (121,889s)
[121,892s][info][gc] GC(657) Concurrent Preclean (121,889s, 121,892s) 2,781ms
[121,892s][info][gc] GC(657) Concurrent Abortable Preclean (121,892s)
[121,949s][info][gc] GC(658) Pause Young (Allocation Failure) 324M-&gt;199M(485M) (121,929s, 121,949s) 19,705ms
[122,068s][info][gc] GC(659) Pause Young (Allocation Failure) 333M-&gt;200M(485M) (122,043s, 122,068s) 24,892ms
[122,075s][info][gc] GC(657) Concurrent Abortable Preclean (121,892s, 122,075s) 182,989ms
[122,087s][info][gc] GC(657) Pause Remark 209M-&gt;209M(485M) (122,076s, 122,087s) 11,373ms
[122,087s][info][gc] GC(657) Concurrent Sweep (122,087s)
[122,193s][info][gc] GC(660) Pause Young (Allocation Failure) 301M-&gt;165M(485M) (122,181s, 122,193s) 12,151ms
[122,254s][info][gc] GC(657) Concurrent Sweep (122,087s, 122,254s) 166,758ms
[122,254s][info][gc] GC(657) Concurrent Reset (122,254s)
[122,255s][info][gc] GC(657) Concurrent Reset (122,254s, 122,255s) 0,952ms
[122,297s][info][gc] GC(661) Pause Young (Allocation Failure) 259M-&gt;128M(485M) (122,291s, 122,297s) 5,797ms
</pre>
<div class="infobox-note" id="GUID-613350C4-0F12-48C4-A004-E5A7FCFB09FB__GUID-BD3ECE63-C497-440C-B862-20B543297985">
<p class="notep1">Note:</p>
The output for the CMS collection (GC ID 657) is interspersed with the output from the minor collections (GC IDs 658, 659 and 660); typically many minor collections occur during a concurrent collection cycle. Pause Initial Mark indicates the start of the concurrent collection cycle. The lines starting with "Concurrent" indicate the start and end of the concurrent phases. Pause Remark is the final pause. Not discussed previously is the precleaning phases. Precleaning represents work that can be done concurrently in preparation for the remark phase. The final phase is indicated by Concurrent Reset and is in preparation for the next concurrent collection.</div>
<p>The initial mark pause is typically short relative to the minor collection pause time. The concurrent phases (concurrent mark, concurrent preclean, and concurrent sweep) normally last significantly longer than a minor collection pause, as indicated in the CMS collector output example. Note, however, that the application isn't paused during these concurrent phases. The remark pause is often comparable in length to a minor collection. The remark pause is affected by certain application characteristics (for example, a high rate of object modification can increase this pause) and the time since the last minor collection (for example, more objects in the young generation may increase this pause).</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment57">
<tr>
<td class="cellalignment69">
<table class="cellalignment62">
<tr>
<td class="cellalignment61"><a href="mostly-concurrent-collectors.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment61"><a href="garbage-first-garbage-collector.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2014, 2018, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment71">
<table class="cellalignment60">
<tr>
<td class="cellalignment61"><a href="http://docs.oracle.com/javase/10/index.html"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment61"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment61"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
